4 Datenmodell und Persistenz

Das Datenmodell von „kardr“ ist auf die eindeutige, reproduzierbare Berechnung von Fälligkeiten nach FSRS ausgerichtet. Zentrale Entitäten sind Karten, Reviews und nutzerspezifische Parameter. Der Server ist dabei die Quelle der Wahrheit für alle FSRS‑Zustandsgrößen und das nächste Fälligkeitsdatum; der Client übermittelt lediglich die Bewertung eines Reviews und den verstrichenen Zeitraum. Auf diese Weise bleiben die Berechnungsregeln konsistent, und konkurrierende Änderungen lassen sich kontrolliert auflösen.

4.1 Collections und Schema

Karten repräsentieren den Lerninhalt und tragen neben Textfeldern wie Vorderseite, Rückseite und optionalen Tags die für FSRS relevanten Zustandsgrößen. Für die Planung wesentlich sind die zuletzt bekannte Stabilität S, eine Schätzung der Schwierigkeit D und die Zeitmarken „zuletzt wiederholt“ sowie „fällig ab“. Die Retrievability R wird nicht dauerhaft gespeichert, sondern bei Bedarf aus S und der verstrichenen Zeit abgeleitet. Zusätzlich hält eine Karte einfache Zähler wie die Anzahl der Wiederholungen und ggf. Fehlversuche, um Auswertungen zu erleichtern. Jede Karte gehört eindeutig zu einer Nutzerin oder einem Nutzer.

Reviews bilden einzelne Wiederholungsereignisse ab. Ein Review verknüpft sich mit einer Karte und einem Nutzer und speichert die abgegebene Bewertung sowie die seit der letzten Wiederholung vergangene Zeit. Um den Verlauf nachvollziehbar zu halten, persistiert ein Review die relevanten Zwischenstände: Stabilität vor dem Review, optional die berechnete Abrufwahrscheinlichkeit, und die neue Stabilität nach Anwendung der FSRS‑Regeln. Ebenfalls festgehalten wird das daraus resultierende nächste Intervall bzw. Fälligkeitsdatum. Damit lassen sich Entscheidungen später auditieren und regressionssicher testen, ohne den Algorithmus jedes Mal erneut auf historische Daten anwenden zu müssen.

Nutzerspezifische Parameter kapseln individuelle Einstellungen, die in die Planung einfließen. Dazu zählen die gewünschte Behaltensrate (Desired Retention) und optional ein Deadline‑Zeitpunkt, der Intervalle in einem definierten Zeitraum kappen darf. Ergänzend können technische Felder wie Zeitzone oder eine Versionsangabe der verwendeten FSRS‑Gewichte abgelegt werden, damit Berechnungsergebnisse auch bei zukünftigen Änderungen der Gewichte nachvollziehbar bleiben.

Zur Effizienz definiert das Schema Indizes auf fällige Karten pro Nutzerin bzw. Nutzer sowie auf die Review‑Historie einer Karte. So können anstehende Wiederholungen schnell ermittelt und chronologisch verarbeitet werden. Fremdschlüsselbeziehungen sorgen dafür, dass zu einer Karte nur Reviews derselben Eigentümerin bzw. desselben Eigentümers existieren und dass Löschvorgänge konsistent sind.

4.2 Migrationen und Hooks

Schemaänderungen werden über Migrationen versioniert, sodass die Einrichtung der Collections und Felder reproduzierbar bleibt. Migrationen legen die Grundstruktur für Karten, Reviews und nutzerspezifische Parameter fest, inklusive Datentypen, Pflichtfeldern und Indizes. Anpassungen – etwa neue Felder für zusätzliche FSRS‑Metriken – werden als neue Migrationen ergänzt und können auf Test‑ und Produktivumgebungen in gleicher Reihenfolge angewandt werden.

Serverseitige Hooks sichern das Verhalten an den entscheidenden Übergabepunkten ab. Beim Anlegen eines Reviews werden die Eingaben validiert, die FSRS‑Größen aus dem aktuellen Kartenzustand und den Nutzereinstellungen berechnet und die Karte in derselben Operation mit neuer Stabilität und Fälligkeit aktualisiert. Dieses Vorgehen hält Karte und Review transaktional konsistent und verhindert, dass mehrere parallele Anfragen widersprüchliche Zustände erzeugen. Validierungen stellen unter anderem sicher, dass Bewertungen nur aus dem erlaubten Werteraum stammen und dass die verstrichene Zeit plausibel ist.

Die API schirmt die Persistenzschicht gegenüber dem Frontend klar ab. Endpunkte nehmen nur die minimal notwendigen Informationen entgegen und liefern den aktualisierten Kartenzustand zusammen mit der nächsten Fälligkeit zurück. Dadurch bleibt der Client schlank, und die Geschäftsregeln liegen zentral auf dem Server, wo sie geloggt, versioniert und getestet werden können. Zusammen mit den Migrationen entsteht so ein Datenmodell, das sowohl lesbar als auch robust ist und die Grundlage für eine faire, kompetitive Nutzung von „kardr“ bildet, ohne die Integrität der FSRS‑Planung zu gefährden.

